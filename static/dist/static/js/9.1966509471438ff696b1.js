webpackJsonp([9],{r6ty:function(e,t){},s6XC:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={props:{bodyArr:Array,default_checked_keys:Array,isTabelPermiss:{type:Number,defalult:0}},computed:{data2:function(){return this.bodyArr}},data:()=>({getCheckedNodes:null,defaultProps:{children:"child",label:"permissionName"},allWrapIdArr:[]}),methods:{handleNodeClick(){let e=this;e.getCheckedNodes=[];this.$refs.tree.getHalfCheckedKeys();let t=this.$refs.tree.getCheckedNodes();console.log(t);let s=[],r=new Set,i=new Set;for(let e=0;e<t.length;e++)t[e].pId&&(s.push(t[e]),r.add(t[e].pId),i.add(t[e].wrapId),t[e].midId&&i.add(t[e].midId));console.log(s),console.log(r);let d=Array.from(r);for(let t=0;t<d.length;t++){let r={permissionId:null,permissionNode:[]};for(let e=0;e<s.length;e++)d[t]==s[e].pId&&(r.permissionId=d[t],s[e]&&s[e].permissionName&&r.permissionNode.push(s[e].permissionName));e.getCheckedNodes.push(r),e.allWrapIdArr=Array.from(i)}},submit(){let e=this;1==e.isTabelPermiss||e.allWrapIdArr.forEach((t,s)=>{let r={};r.permissionId=t,e.getCheckedNodes.push(r)}),this.$emit("treeSubmit",this.getCheckedNodes)}}},i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-tree",{ref:"tree",attrs:{data:this.data2,"default-expanded-keys":[1,3],props:this.defaultProps,"default-checked-keys":this.default_checked_keys,"node-key":"permissionId","show-checkbox":""},on:{"check-change":this.handleNodeClick}}),this._v(" "),t("div",{staticClass:"submit permissBtn dcp",on:{click:this.submit}},[this._v("提交授权")])],1)},staticRenderFns:[]};var d=s("C7Lr")(r,i,!1,function(e){s("td7d")},"data-v-996361ba",null).exports,a={components:{position:s("t/xR").a,treeInputTb:d},data:()=>({accessList:[],roleInfo:null,default_checked_keys:[]}),mounted(){let e=this;e.$route.params&&e.$route.params.data?(e.roleInfo=e.$route.params.data,e.getList(),e.roleTablePermission()):e.$router.push({path:"/roleList"})},methods:{roleTablePermission(){let e=this,t=e.$base_url+"role/relevance/permission?show=table&roleId="+e.roleInfo.roleId;e.$axios.get(t).then(t=>{if(t.data&&0==t.data.resultCode){let s=t.data.content.data,r=new Set;for(let e=0;e<s.length;e++)if(s[e].permissionId&&r.add(s[e].permissionId),s[e].child){let t=s[e].child;for(let e=0;e<t.length;e++)if(t[e].permissionId&&r.add(t[e].permissionId),t[e].permissionNode){let s=t[e].permissionNode;for(let e=0;e<s.length;e++)s[e].permissionId&&r.add(s[e].permissionId)}else if(t[e].child){let s=t[e].child;for(let e=0;e<s.length;e++)if(s[e].permissionId&&r.add(s[e].permissionId),s[e].permissionNode){let t=s[e].permissionNode;for(let e=0;e<t.length;e++)t[e].permissionId&&r.add(t[e].permissionId)}}}let i=Array.from(r),d=[];for(let e=0;e<i.length;e++)i[e]>=1e7&&d.push(i[e]);e.default_checked_keys=d}else this.$message({message:t.data.result,type:"error"})})},treeSubmit(e){if(!e)return;let t={roleId:this.roleInfo.roleId,permissionData:e,isMenu:2},s=this.$base_url+"role/relevance/permission";this.$axios.post(s,t).then(e=>{e.data&&0==e.data.resultCode?this.$message({message:"授权成功",type:"success"}):this.$message({message:e.data.result,type:"error"})})},getList(){let e=this,t=this.$base_url+"permission?show=table";e.$axios.get(t).then(t=>{if(t.data&&0==t.data.resultCode){let s=t.data.content.data;for(let e=0;e<s.length;e++){s[e].permissionName=s[e].departmentName;let t=s[e].child;if(t)for(let r=0;r<t.length;r++){t[r].permissionName=t[r].departmentName;let i=t[r].child;if(i)for(let d=0;d<i.length;d++)if(i[d].child){let a=i[d].child;for(let o=0;o<a.length;o++)a[o].wrapId=s[e].departmentId,a[o].midId=t[r].departmentId,a[o].pId=i[d].permissionId,console.log(1)}else t[r].permissionId&&(i[d].wrapId=s[e].permissionId,i[d].pId=t[d].permissionId)}}console.log(s),e.accessList=s}else this.$message({message:t.data.result,type:"error"})}).catch(e=>{})}}},o={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"vc uservc"},[s("position",{attrs:{title:"系统设置 > 角色表授权"}}),e._v(" "),s("div",{staticClass:"ctt"},[e.roleInfo?s("div",{staticClass:"role"},[e._v("\n\t\t\t"+e._s(e.roleInfo.roleName)+"\n\t\t")]):e._e(),e._v(" "),s("div",{staticClass:"treeWrap userMngView dafter_ctt_dspBlock_clearBoth"},[e.accessList.length>0?s("treeInputTb",{attrs:{isTabelPermiss:1,bodyArr:e.accessList,default_checked_keys:e.default_checked_keys},on:{treeSubmit:e.treeSubmit}}):e._e()],1)])],1)},staticRenderFns:[]};var l=s("C7Lr")(a,o,!1,function(e){s("r6ty")},"data-v-652def50",null);t.default=l.exports},td7d:function(e,t){}});